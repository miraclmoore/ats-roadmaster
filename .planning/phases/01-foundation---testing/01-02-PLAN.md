---
phase: 01-foundation---testing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/package.json
  - web/playwright.config.ts
  - web/e2e/live-telemetry.spec.ts
autonomous: true

must_haves:
  truths:
    - "Developer runs npm run test:e2e and sees browser automation testing live telemetry flow"
    - "Test verifies user can see live dashboard when telemetry data exists"
    - "Test handles empty state when no telemetry available"
    - "Test runs in headless mode suitable for CI"
  artifacts:
    - path: "web/playwright.config.ts"
      provides: "Playwright configuration with baseURL and webServer"
      min_lines: 30
    - path: "web/e2e/live-telemetry.spec.ts"
      provides: "E2E test for live telemetry page"
      min_lines: 50
  key_links:
    - from: "web/playwright.config.ts"
      to: "npm run dev"
      via: "webServer.command"
      pattern: "command:.*npm run dev"
    - from: "web/e2e/live-telemetry.spec.ts"
      to: "/live"
      via: "page.goto"
      pattern: "page\\.goto\\(['\"][^'\"]*live"
---

<objective>
Establish Playwright E2E testing infrastructure and verify real-time telemetry flow works end-to-end.

Purpose: Ensure critical user journey (viewing live telemetry) works across authentication, data fetching, and real-time updates
Output: Working E2E test suite that can run in CI pipeline
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation---testing/01-RESEARCH.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md

# Live telemetry page structure
@web/app/(dashboard)/live/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Install Playwright and configure E2E environment</name>
  <files>
    web/package.json
    web/playwright.config.ts
  </files>
  <action>
    Install Playwright using official init command:
    ```bash
    cd web && npm init playwright@latest -- --yes --install-deps --browser=chromium --browser=firefox --browser=webkit --gha
    ```

    This automatically creates playwright.config.ts with defaults. Modify the generated config:

    Key settings to verify/update:
    - testDir: './e2e' (not './tests' - use e2e directory)
    - fullyParallel: true (run tests in parallel)
    - forbidOnly: !!process.env.CI (prevent .only in CI)
    - retries: process.env.CI ? 2 : 0 (retry flaky tests in CI)
    - workers: process.env.CI ? 1 : undefined (1 worker in CI, auto locally)
    - reporter: 'html' (generate HTML report)
    - use.baseURL: 'http://localhost:3000' (use relative paths in tests)
    - use.trace: 'on-first-retry' (collect trace on retry for debugging)
    - projects: chromium, firefox, webkit (all three browsers)
    - webServer.command: 'npm run dev'
    - webServer.url: 'http://localhost:3000'
    - webServer.reuseExistingServer: !process.env.CI (reuse dev server locally)

    Add test script to package.json:
    - "test:e2e": "playwright test"
    - "test:e2e:ui": "playwright test --ui" (interactive mode)

    CRITICAL: Do NOT hardcode localhost:3000 in test files - use relative paths with baseURL
  </action>
  <verify>
    Run `cd web && npx playwright --version` and see Playwright version
    Run `cd web && npx playwright test --list` and see "no tests found" (expected - not written yet)
    Check that web/playwright.config.ts exists with webServer.command set to 'npm run dev'
  </verify>
  <done>
    Playwright installed with chromium/firefox/webkit browsers, config file created with baseURL and dev server setup, test scripts added to package.json
  </done>
</task>

<task type="auto">
  <name>Write E2E test for live telemetry page</name>
  <files>
    web/e2e/live-telemetry.spec.ts
  </files>
  <action>
    Create `web/e2e/live-telemetry.spec.ts` to test the critical user journey for live telemetry.

    Import Playwright test utilities:
    ```typescript
    import { test, expect } from '@playwright/test'
    ```

    Test structure (3 test cases):

    **Test 1: "displays empty state when no telemetry data"**
    - Navigate to '/' (landing page)
    - Check if login form exists OR already authenticated
    - If login form visible, skip test (requires auth setup)
    - If authenticated, navigate to '/live'
    - Wait for page to load
    - Check for text "Waiting for game data" OR "No telemetry" (empty state)
    - Verify no crash, page renders successfully

    **Test 2: "page loads without errors"**
    - Navigate to '/live' directly
    - Wait for page load
    - Verify page title contains "Live" or "Telemetry" or "RoadMaster"
    - Check that page header is visible
    - Verify no console errors logged

    **Test 3: "live page has expected layout structure"**
    - Navigate to '/live'
    - Verify PageHeader component renders
    - Check for dashboard layout (cards, gauges expected structure)
    - Verify sidebar navigation is visible (desktop) or menu button (mobile)

    Use Playwright's auto-waiting (do NOT use manual sleep):
    - page.goto() waits for load event
    - page.locator() waits for element to be visible
    - expect(locator).toBeVisible() waits up to 5s

    Handle authentication:
    - For now, test unauthenticated behavior (redirect to login)
    - Add comment: "TODO: Add authentication setup for authenticated tests"
    - Document in test file that authenticated flow requires setup

    IMPORTANT: Use relative paths (page.goto('/live')) not absolute URLs
    IMPORTANT: These are smoke tests - full authenticated flow testing deferred to future plans
  </action>
  <verify>
    Run `cd web && npm run test:e2e` and see tests execute in headless browsers
    Verify test output shows 3 tests running across chromium/firefox/webkit
    Tests should pass (may skip auth-required scenarios gracefully)
  </verify>
  <done>
    live-telemetry.spec.ts exists with 3 smoke tests verifying page loads, renders layout, handles empty state, no authentication mocking required yet
  </done>
</task>

</tasks>

<verification>
Run `cd web && npm run test:e2e -- --reporter=list` and see:
- live-telemetry.spec.ts tests execute
- Tests run in all three browsers (chromium, firefox, webkit)
- Dev server starts automatically before tests
- Tests complete without crashes or timeouts
- HTML report generated in playwright-report/
</verification>

<success_criteria>
- Developer runs `npm run test:e2e` and sees Playwright execute cross-browser tests
- live-telemetry.spec.ts verifies live page loads and renders without crashing
- Tests use baseURL config and relative paths (no hardcoded localhost:3000)
- Playwright config includes webServer that auto-starts Next.js dev server
- Tests run in headless mode suitable for CI execution
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation---testing/01-02-SUMMARY.md`
</output>
