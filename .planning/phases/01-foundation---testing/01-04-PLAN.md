---
phase: 01-foundation---testing
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - web/components/ui/button.tsx
  - web/components/ui/card.tsx
  - web/components/ui/badge.tsx
  - web/app/globals.css
  - web/components.json
  - web/package.json
  - .github/workflows/test.yml
autonomous: true

must_haves:
  truths:
    - "Developer imports Button from @/components/ui/button and sees automotive-themed component"
    - "Developer imports Card from @/components/ui/card and uses it in dashboard"
    - "CI pipeline runs all tests (unit, E2E, database) on every commit"
    - "CI generates and uploads coverage reports to artifacts"
    - "CI blocks merge if any test fails"
  artifacts:
    - path: "web/components/ui/button.tsx"
      provides: "shadcn/ui Button with automotive theme"
      min_lines: 30
    - path: "web/components/ui/card.tsx"
      provides: "shadcn/ui Card with dark theme styling"
      min_lines: 40
    - path: "web/app/globals.css"
      provides: "Tailwind v4 theme with automotive colors"
      contains: "@theme inline"
    - path: ".github/workflows/test.yml"
      provides: "GitHub Actions workflow for CI testing with coverage reporting"
      min_lines: 60
  key_links:
    - from: "web/components/ui/button.tsx"
      to: "class-variance-authority"
      via: "cva import"
      pattern: "import.*cva.*from.*class-variance-authority"
    - from: "web/app/globals.css"
      to: "@theme inline"
      via: "Tailwind v4 theme directive"
      pattern: "@theme inline"
    - from: ".github/workflows/test.yml"
      to: "vitest run --coverage"
      via: "coverage step"
      pattern: "npm run test:coverage"
---

<objective>
Initialize shadcn/ui design system with automotive theme primitives and establish CI pipeline for automated testing with coverage reporting.

Purpose: Provide reusable themed components for safe refactoring and ensure tests run automatically on every commit with coverage metrics tracked
Output: Working design system primitives (Button, Card, Badge) and GitHub Actions CI pipeline with coverage reporting
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation---testing/01-RESEARCH.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md

# Existing globals.css to extend
@web/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Initialize shadcn/ui and install core components</name>
  <files>
    web/components.json
    web/components/ui/button.tsx
    web/components/ui/card.tsx
    web/components/ui/badge.tsx
    web/package.json
  </files>
  <action>
    Initialize shadcn/ui CLI configuration:
    ```bash
    cd web && npx shadcn@latest init
    ```

    When prompted, select:
    - Style: Default
    - Base color: Zinc (will customize with automotive theme)
    - CSS variables: Yes
    - Use TypeScript: Yes
    - Path alias: @/components
    - React Server Components: Yes

    This creates `web/components.json` configuration file.

    Install core UI components:
    ```bash
    cd web && npx shadcn@latest add button card badge
    ```

    This creates:
    - web/components/ui/button.tsx
    - web/components/ui/card.tsx
    - web/components/ui/badge.tsx

    Verify components use class-variance-authority (cva) for variant management.
    Verify components import cn utility from @/lib/utils (tailwind-merge wrapper).

    IMPORTANT: shadcn components are copied into project (not npm packages), providing full control for theming
    IMPORTANT: These are foundation components - more complex components added in later phases
  </action>
  <verify>
    Run `ls web/components/ui/` and see button.tsx, card.tsx, badge.tsx
    Check that web/components.json exists with correct configuration
    Verify Button component exports variants (default, destructive, outline, ghost)
  </verify>
  <done>
    shadcn/ui initialized, Button/Card/Badge components installed with cva variant system, components.json config created
  </done>
</task>

<task type="auto">
  <name>Apply automotive theme to Tailwind CSS v4</name>
  <files>
    web/app/globals.css
  </files>
  <action>
    Update `web/app/globals.css` to use Tailwind CSS v4 theme system with automotive colors following RESEARCH.md pattern.

    Replace or update the CSS variable definitions with automotive-authentic colors:

    **Color Palette (Diesel Truck Aesthetic):**
    - Background: Dark charcoal (hsl(240 5% 6%))
    - Foreground: Off-white (hsl(60 5% 90%))
    - Card: Slightly lighter charcoal (hsl(240 4% 9%))
    - Primary: Amber/orange (hsl(35 100% 50%)) - warning lights, active gauges
    - Secondary: Steel blue (hsl(200 80% 50%)) - info displays
    - Accent: Red (hsl(10 80% 50%)) - brake lights, critical warnings
    - Muted: Dark gray (hsl(240 5% 15%))
    - Border: Subtle gray (hsl(240 6% 20%))

    Structure following Tailwind v4:
    ```css
    @import "tailwindcss";
    @plugin "@tailwindcss/typography";

    /* Move :root variables OUTSIDE @layer base for Tailwind v4 */
    :root {
      --background: hsl(240 5% 6%);
      --foreground: hsl(60 5% 90%);
      --card: hsl(240 4% 9%);
      --card-foreground: hsl(60 5% 90%);
      --primary: hsl(35 100% 50%);
      --primary-foreground: hsl(240 5% 6%);
      --secondary: hsl(200 80% 50%);
      --secondary-foreground: hsl(60 5% 90%);
      --muted: hsl(240 5% 15%);
      --muted-foreground: hsl(60 5% 60%);
      --accent: hsl(10 80% 50%);
      --accent-foreground: hsl(60 5% 90%);
      --destructive: hsl(0 84% 60%);
      --destructive-foreground: hsl(60 5% 90%);
      --border: hsl(240 6% 20%);
      --input: hsl(240 6% 20%);
      --ring: hsl(35 100% 50%);
      --radius: 0.5rem;
    }

    @theme inline {
      --color-background: var(--background);
      --color-foreground: var(--foreground);
      --color-card: var(--card);
      --color-card-foreground: var(--card-foreground);
      --color-primary: var(--primary);
      --color-primary-foreground: var(--primary-foreground);
      --color-secondary: var(--secondary);
      --color-secondary-foreground: var(--secondary-foreground);
      --color-muted: var(--muted);
      --color-muted-foreground: var(--muted-foreground);
      --color-accent: var(--accent);
      --color-accent-foreground: var(--accent-foreground);
      --color-destructive: var(--destructive);
      --color-destructive-foreground: var(--destructive-foreground);
      --color-border: var(--border);
      --color-input: var(--input);
      --color-ring: var(--ring);
    }
    ```

    CRITICAL: Use hsl() format (Tailwind v4 requirement)
    CRITICAL: Use @theme inline directive to map CSS variables to Tailwind utilities
    CRITICAL: Preserve any existing custom utilities or animations below the theme
  </action>
  <verify>
    Run `cd web && npm run build` and verify no CSS compilation errors
    Check that globals.css contains automotive color palette with amber primary
    Verify @theme inline directive is present
  </verify>
  <done>
    globals.css updated with Tailwind v4 automotive theme using hsl() colors, @theme inline directive, dark charcoal background with amber accents
  </done>
</task>

<task type="auto">
  <name>Create GitHub Actions CI pipeline with coverage reporting</name>
  <files>
    .github/workflows/test.yml
  </files>
  <action>
    Create `.github/workflows/test.yml` following Playwright CI documentation pattern from RESEARCH.md with added coverage reporting.

    Workflow structure:

    ```yaml
    name: Test
    on:
      push:
        branches: [main, develop]
      pull_request:
        branches: [main, develop]

    jobs:
      test:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4

          - uses: actions/setup-node@v4
            with:
              node-version: 20
              cache: 'npm'
              cache-dependency-path: web/package-lock.json

          - name: Install dependencies
            run: cd web && npm ci

          - name: Run unit tests with coverage
            run: cd web && npm run test:coverage

          - name: Upload coverage reports
            if: always()
            uses: actions/upload-artifact@v4
            with:
              name: coverage-report
              path: web/coverage/
              retention-days: 7

          - name: Install Playwright browsers
            run: cd web && npx playwright install --with-deps

          - name: Run E2E tests
            run: cd web && npm run test:e2e

          - name: Upload Playwright report on failure
            if: failure()
            uses: actions/upload-artifact@v4
            with:
              name: playwright-report
              path: web/playwright-report/
              retention-days: 7

          - name: Run database tests (skipped - requires Supabase instance)
            run: echo "Database tests require Supabase local instance setup - TODO Phase 2"
    ```

    Key features:
    - Trigger on push to main/develop and pull requests
    - Install Node.js 20 with npm caching
    - Run unit tests with coverage FIRST (fast feedback)
    - Upload coverage reports as artifacts (available even on success)
    - Install Playwright browsers with system dependencies
    - Run E2E tests in headless mode
    - Upload test artifacts on failure for debugging
    - Document database test limitation (needs Supabase setup in CI)

    IMPORTANT: Database tests skipped for now (requires Supabase CLI and local instance in CI)
    IMPORTANT: Coverage reports uploaded on every run (if: always()) for tracking metrics
    IMPORTANT: Use npm run test:coverage instead of npm test -- --run
  </action>
  <verify>
    Check that .github/workflows/test.yml exists with valid YAML syntax
    Verify workflow runs unit tests with coverage and E2E tests sequentially
    Verify workflow uploads coverage artifacts on every run
    Verify workflow uploads test reports on failure
  </verify>
  <done>
    GitHub Actions workflow created running unit tests with coverage reporting and E2E tests on every push/PR, uploads coverage reports on all runs and test reports on failure, documents database test deferral
  </done>
</task>

</tasks>

<verification>
Verify locally:
- `cd web && npx shadcn@latest add button` shows "button already installed"
- `cd web && npm run build` succeeds with no CSS errors
- Button/Card/Badge components import successfully from @/components/ui/*
- globals.css contains automotive theme with amber primary color

Verify in GitHub (after push):
- GitHub Actions workflow appears in .github/workflows/
- Workflow triggers on next push
- Tests run automatically in CI environment
- Coverage reports uploaded to artifacts section
</verification>

<success_criteria>
- Developer imports Button, Card, Badge from @/components/ui/ with automotive theme applied
- globals.css uses Tailwind v4 @theme inline directive with automotive color palette
- Dark theme with amber primary, steel blue secondary, red accent colors
- GitHub Actions workflow runs unit tests with coverage and E2E tests on every commit
- CI pipeline uploads coverage reports as artifacts on every run (pass or fail)
- CI pipeline blocks merge on test failures with uploaded artifacts for debugging
- Coverage reports include HTML format for easy review
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation---testing/01-04-SUMMARY.md`
</output>
